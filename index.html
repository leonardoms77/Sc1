<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Book PETR4</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #e3e3e3;
    }
    #orderBookContainer {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #aaa;
      background: white;
    }
    .buy { background-color: #e0f7e9; }
    .sell { background-color: #fdecea; }
  </style>
</head>
<body>
  <h1>Simulador de Book PETR4</h1>  <h2>Portfólios</h2>
  <table id="portfolio">
    <thead>
      <tr>
        <th>Player</th>
        <th>Caixa</th>
        <th>Quantidade PETR4</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>  <h2>Book de Ofertas</h2>
  <div id="orderBookContainer">
    <table id="orderBook">
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Player</th>
          <th>Quantidade</th>
          <th>Preço</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>  <script>
    const players = [
      'UBS Pactual', 'Credit Suisse', 'Morgan Stanley', 'Merrill Lynch', 'XP'
    ];

    const portfolio = {};
    players.forEach(p => {
      portfolio[p] = { caixa: 700_000_000, petr4: 0 };
    });

    const orderBook = [];

    function renderPortfolio() {
      const tbody = document.querySelector("#portfolio tbody");
      tbody.innerHTML = "";
      players.forEach(p => {
        const { caixa, petr4 } = portfolio[p];
        tbody.innerHTML += `
          <tr>
            <td>${p}</td>
            <td>R$ ${caixa.toLocaleString('pt-BR')}</td>
            <td>${petr4.toLocaleString('pt-BR')}</td>
          </tr>
        `;
      });
    }

    function renderOrderBook() {
      const tbody = document.querySelector("#orderBook tbody");
      tbody.innerHTML = "";
      orderBook.forEach((ordem, idx) => {
        tbody.innerHTML += `
          <tr class="${ordem.tipo}">
            <td>${ordem.tipo.toUpperCase()}</td>
            <td>${ordem.player}</td>
            <td>${ordem.quantidade.toLocaleString('pt-BR')}</td>
            <td>R$ ${ordem.preco.toFixed(2)}</td>
            <td>
              ${ordem.tipo === 'sell' && ordem.player !== 'UBS Pactual' ? `<button onclick="executarOrdem(${idx})">Comprar</button>` :
                 ordem.tipo === 'buy' && ordem.player !== 'UBS Pactual' ? `<button onclick="executarOrdem(${idx})">Vender</button>` :
                 ''}
            </td>
          </tr>
        `;
      });
    }

    function executarOrdem(idx) {
      const ordem = orderBook[idx];
      const quantidade = ordem.quantidade;
      const preco = ordem.preco;
      const total = quantidade * preco;

      if (ordem.tipo === 'sell') {
        if (portfolio['UBS Pactual'].caixa >= total) {
          portfolio['UBS Pactual'].caixa -= total;
          portfolio['UBS Pactual'].petr4 += quantidade;
          portfolio[ordem.player].caixa += total;
          portfolio[ordem.player].petr4 -= quantidade;
        } else {
          alert('Caixa insuficiente para comprar');
          return;
        }
      } else if (ordem.tipo === 'buy') {
        if (portfolio['UBS Pactual'].petr4 >= quantidade) {
          portfolio['UBS Pactual'].caixa += total;
          portfolio['UBS Pactual'].petr4 -= quantidade;
          portfolio[ordem.player].caixa -= total;
          portfolio[ordem.player].petr4 += quantidade;
        } else {
          alert('PETR4 insuficiente para vender');
          return;
        }
      }

      orderBook.splice(idx, 1);
      renderPortfolio();
      renderOrderBook();
    }

    function gerarOrdensFalsas() {
      const tipos = ['buy', 'sell'];
      const precos = [35.2, 35.1, 35.0, 34.9, 34.8, 35.3, 35.4, 35.5];

      for (let i = 0; i < 30; i++) {
        const tipo = tipos[Math.floor(Math.random() * 2)];
        const player = players[Math.floor(Math.random() * players.length)];
        const quantidade = Math.floor(Math.random() * 30 + 1) * 100;
        const preco = precos[Math.floor(Math.random() * precos.length)];

        orderBook.push({ tipo, player, quantidade, preco });
      }
    }

    gerarOrdensFalsas();
    renderPortfolio();
    renderOrderBook();
  </script></body>
</html>
