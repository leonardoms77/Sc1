<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Mercado - PETR4</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 1rem;
    }
    h1, h2 {
      text-align: center;
    }
    .container {
      display: flex;
      gap: 1rem;
      justify-content: space-between;
      margin-top: 1rem;
    }
    .book {
      width: 45%;
      border: 1px solid #444;
      padding: 1rem;
      overflow-y: auto;
      max-height: 400px;
    }
    .book h3 {
      margin-top: 0;
    }
    .order {
      display: flex;
      justify-content: space-between;
      padding: 0.25rem;
      margin-bottom: 0.25rem;
    }
    .buy { background-color: #002f00; }
    .sell { background-color: #300000; }
    .executing { background-color: #555500; }
    .ipo-panel {
      background-color: #222;
      border: 1px solid #555;
      padding: 1rem;
      margin-bottom: 1rem;
    }
    .ipo-panel div {
      margin: 0.5rem 0;
    }
  </style>
</head>
<body>
  <h1>Simulador de Book de Ofertas - PETR4</h1>  <div class="ipo-panel">
    <h2>IPO Petrobras</h2>
    <div id="ipo-restantes">Ações restantes: 8.000.000.000</div>
    <div id="ipo-hoje">Vendidas hoje: 0</div>
    <div id="ipo-hoje-valor">Valor arrecadado hoje: R$ 0</div>
    <div id="ipo-total">Total arrecadado: R$ 0</div>
  </div>  <div class="container">
    <div class="book" id="book-compra">
      <h3>Book de Compras</h3>
    </div>
    <div class="book" id="book-venda">
      <h3>Book de Vendas</h3>
    </div>
  </div>  <script>
    let ipoTotal = 8000000000;
    let ipoVendidasHoje = 0;
    let ipoTotalArrecadado = 0;

    const players = {
      'UBS Pactual': { caixa: 700_000_000, acoes: 0 },
      'Credit Suisse': { caixa: 700_000_000, acoes: 0 },
      'Morgan Stanley': { caixa: 700_000_000, acoes: 0 },
      'Merrill Lynch': { caixa: 700_000_000, acoes: 0 },
      'XP': { caixa: 700_000_000, acoes: 0 },
      'Bradesco': { caixa: 700_000_000, acoes: 0 },
    };

    let bookCompra = [];
    let bookVenda = [];

    function renderBook() {
      const compra = document.getElementById("book-compra");
      const venda = document.getElementById("book-venda");

      compra.innerHTML = '<h3>Book de Compras</h3>';
      venda.innerHTML = '<h3>Book de Vendas</h3>';

      bookCompra.slice(0, 20).forEach(o => {
        const div = document.createElement("div");
        div.className = `order buy ${o.executing ? 'executing' : ''}`;
        div.innerHTML = `<span>${o.banco}</span><span>${o.qtd.toLocaleString()}</span><span>R$ ${o.preco.toFixed(2)}</span>`;
        compra.appendChild(div);
      });

      bookVenda.slice(0, 20).forEach(o => {
        const div = document.createElement("div");
        div.className = `order sell ${o.executing ? 'executing' : ''}`;
        div.innerHTML = `<span>${o.banco}</span><span>${o.qtd.toLocaleString()}</span><span>R$ ${o.preco.toFixed(2)}</span>`;
        venda.appendChild(div);
      });
    }

    function atualizarIPO(valorVenda, qtd) {
      ipoTotal -= qtd;
      ipoVendidasHoje += qtd;
      ipoTotalArrecadado += valorVenda;

      document.getElementById("ipo-restantes").innerText = `Ações restantes: ${ipoTotal.toLocaleString()}`;
      document.getElementById("ipo-hoje").innerText = `Vendidas hoje: ${ipoVendidasHoje.toLocaleString()}`;
      document.getElementById("ipo-hoje-valor").innerText = `Valor arrecadado hoje: R$ ${qtd * valorVenda}`;
      document.getElementById("ipo-total").innerText = `Total arrecadado: R$ ${ipoTotalArrecadado.toLocaleString()}`;
    }

    function gerarOrdemBradesco() {
      // Gera lotes variados entre 100 e 3.000 ações
      const lote = Math.floor(Math.random() * 30 + 1) * 100;
      const preco = 30 + Math.random();
      bookVenda.push({ banco: 'Bradesco', qtd: lote, preco, executing: false });
    }

    function executarOrdens() {
      bookCompra.sort((a, b) => b.preco - a.preco);
      bookVenda.sort((a, b) => a.preco - b.preco);

      for (let i = 0; i < Math.min(bookCompra.length, bookVenda.length); i++) {
        const compra = bookCompra[i];
        const venda = bookVenda[i];

        if (compra.preco >= venda.preco) {
          const qtdExecutada = Math.min(compra.qtd, venda.qtd);
          const preco = venda.preco;

          players[compra.banco].caixa -= qtdExecutada * preco;
          players[compra.banco].acoes += qtdExecutada;

          players[venda.banco].caixa += qtdExecutada * preco;
          players[venda.banco].acoes -= qtdExecutada;

          if (venda.banco === 'Bradesco') atualizarIPO(preco, qtdExecutada);

          compra.qtd -= qtdExecutada;
          venda.qtd -= qtdExecutada;

          compra.executing = true;
          venda.executing = true;

          if (compra.qtd === 0) bookCompra.splice(i, 1);
          if (venda.qtd === 0) bookVenda.splice(i, 1);

          break;
        }
      }
    }

    function ciclo() {
      gerarOrdemBradesco();
      executarOrdens();
      renderBook();
    }

    setInterval(ciclo, 1000);
  </script></body>
</html>
