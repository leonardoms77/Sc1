lios();
  </script></body>
</html>
<!DOCTYPE html><html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Simulador de Book PETR4</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 20px;
      background-color: #f4f4f4;
    }
    .book-container {
      height: 300px;
      overflow-y: auto;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
    }
    .buy {
      background-color: #e0ffe0;
      color: green;
    }
    .sell {
      background-color: #ffe0e0;
      color: red;
    }
    .controls, .robot-settings, .ipo-panel {
      grid-column: span 2;
      background: #fff;
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
    }
    input {
      margin: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 4px;
      border: 1px solid #ccc;
      text-align: right;
    }
  </style>
</head>
<body><div class="book-container" id="buyBook"></div>
<div class="book-container" id="sellBook"></div><div class="controls">
  <h3>Ordem Manual</h3>
  <select id="ordemTipo">
    <option value="buy">Compra</option>
    <option value="sell">Venda</option>
  </select>
  Quantidade: <input type="number" id="ordemQtd" value="100">
  Preço: <input type="number" id="ordemPreco" step="0.01" value="30">
  <button onclick="adicionarOrdemManual()">Inserir</button>
</div><div class="robot-settings">
  <h3>Configurar Robô UBS Pactual</h3>
  <select id="modoRobo">
    <option value="mercado">A Mercado</option>
    <option value="abaixo">Compra abaixo do preço</option>
  </select>
  Diferença (ex: 0.2): <input type="number" id="ajustePreco" step="0.01" value="0.2">
</div><div class="ipo-panel">
  <h3>IPO Petrobras</h3>
  <p>Total de ações: <span id="totalAcoes">8000000000</span></p>
  <p>Restantes: <span id="acoesRestantes">8000000000</span></p>
  <p>Capital captado: R$ <span id="capitalCaptado">0.00</span></p>
</div><div class="controls">
  <button onclick="toggleSimulacao()">Pausar/Continuar</button>
  <button onclick="salvarEstado()">Salvar</button>
  <button onclick="carregarEstado()">Carregar</button>
</div><script>
let buyBook = [], sellBook = [];
let saldo = {
  'UBS': 700000000,
  'Credit Suisse': 700000000,
  'Morgan Stanley': 700000000,
  'Merrill Lynch': 700000000,
  'XP': 700000000,
  'Bradesco': 700000000
};
let acoesBradesco = 8000000000;
let capitalCaptado = 0;
let ciclo = 0;
let rodando = true;

function renderBook() {
  document.getElementById('buyBook').innerHTML = '<h3>Compra</h3>' + bookHTML(buyBook.slice(0, 20), 'buy');
  document.getElementById('sellBook').innerHTML = '<h3>Venda</h3>' + bookHTML(sellBook.slice(0, 20), 'sell');
  document.getElementById('acoesRestantes').textContent = acoesBradesco;
  document.getElementById('capitalCaptado').textContent = capitalCaptado.toFixed(2);
}

function bookHTML(book, tipo) {
  return '<table><tr><th>Player</th><th>Qtd</th><th>Preço</th></tr>' +
    book.map(o => `<tr class="${tipo}"><td>${o.player}</td><td>${o.qtd}</td><td>${o.preco.toFixed(2)}</td></tr>`).join('') +
    '</table>';
}

function adicionarOrdemManual() {
  const tipo = document.getElementById('ordemTipo').value;
  const qtd = parseInt(document.getElementById('ordemQtd').value);
  const preco = parseFloat(document.getElementById('ordemPreco').value);
  const ordem = { player: 'UBS', qtd, preco };
  if (tipo === 'buy') buyBook.push(ordem);
  else sellBook.push(ordem);
  ordenarBooks();
  renderBook();
}

function ordenarBooks() {
  buyBook.sort((a, b) => b.preco - a.preco);
  sellBook.sort((a, b) => a.preco - b.preco);
}

function roboUBS() {
  const modo = document.getElementById('modoRobo').value;
  const ajuste = parseFloat(document.getElementById('ajustePreco').value);
  if (modo === 'mercado' && sellBook.length > 0) {
    const melhor = sellBook[0];
    adicionarOrdem('UBS', 'buy', melhor.qtd, melhor.preco);
  } else if (modo === 'abaixo' && sellBook.length > 0) {
    const preco = sellBook[0].preco - ajuste;
    adicionarOrdem('UBS', 'buy', 100, preco);
  }
}

function adicionarOrdem(player, tipo, qtd, preco) {
  const ordem = { player, qtd, preco };
  if (tipo === 'buy') buyBook.push(ordem);
  else sellBook.push(ordem);
  ordenarBooks();
}

function simularCiclo() {
  if (!rodando) return;
  ciclo++;

  if (acoesBradesco > 0) {
    const qtd = Math.min(400000, acoesBradesco);
    const preco = 30 + Math.random();
    sellBook.push({ player: 'Bradesco', qtd, preco });
    acoesBradesco -= qtd;
    capitalCaptado += qtd * preco;
  }

  roboUBS();

  // Executar ordens
  while (buyBook.length > 0 && sellBook.length > 0 && buyBook[0].preco >= sellBook[0].preco) {
    const qtd = Math.min(buyBook[0].qtd, sellBook[0].qtd);
    const preco = sellBook[0].preco;
    saldo[buyBook[0].player] -= qtd * preco;
    saldo[sellBook[0].player] += qtd * preco;
    buyBook[0].qtd -= qtd;
    sellBook[0].qtd -= qtd;
    if (buyBook[0].qtd === 0) buyBook.shift();
    if (sellBook[0].qtd === 0) sellBook.shift();
  }
  renderBook();
}

setInterval(simularCiclo, 1000);

function toggleSimulacao() {
  rodando = !rodando;
}

function salvarEstado() {
  const estado = {
    buyBook, sellBook, saldo, acoesBradesco, capitalCaptado, ciclo
  };
  localStorage.setItem('estadoSimulador', JSON.stringify(estado));
}

function carregarEstado() {
  const estado = JSON.parse(localStorage.getItem('estadoSimulador'));
  if (estado) {
    buyBook = estado.buyBook;
    sellBook = estado.sellBook;
    saldo = estado.saldo;
    acoesBradesco = estado.acoesBradesco;
    capitalCaptado = estado.capitalCaptado;
    ciclo = estado.ciclo;
    renderBook();
  }
}
</script></body>
</html>
